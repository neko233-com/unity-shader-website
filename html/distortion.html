<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰­æ›²æ•ˆæœ - Unity URP 2022 LTS æ•™ç¨‹</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>URP æ•™ç¨‹</h1>
            </div>
            <nav class="nav-menu" id="navMenu">
                <div class="nav-section">
                    <h3>âœ¨ ç‰¹æ•ˆç³»ç»Ÿ</h3>
                    <ul>
                        <li><a href="dissolve.html">æº¶è§£æ•ˆæœ</a></li>
                        <li><a href="fresnel.html">è²æ¶…å°”æ•ˆæœ</a></li>
                        <li><a href="rim-light.html">è¾¹ç¼˜å…‰</a></li>
                        <li><a href="distortion.html" class="active">æ‰­æ›²æ•ˆæœ</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="function-page">
                <h1>æ‰­æ›²æ•ˆæœ (Distortion)</h1>
                <p class="subtitle">å±å¹•ç©ºé—´çš„æŠ˜å°„å’Œæ‰­æ›²</p>

                <div class="section">
                    <h2>ğŸ“š åŸç†</h2>
                    <p>æ‰­æ›²æ•ˆæœé€šè¿‡åç§»å±å¹• UV æ¥æ¨¡æ‹ŸæŠ˜å°„ã€çƒ­æµªã€æ°´ä¸‹ç­‰è§†è§‰æ•ˆæœã€‚æ ¸å¿ƒæ˜¯é‡‡æ ·å±å¹•é¢œè‰²çº¹ç†ï¼ˆ_CameraOpaqueTextureï¼‰æ—¶ä½¿ç”¨åç§»åçš„ UVã€‚</p>
                    
                    <div class="diagram-container">
                        <svg viewBox="0 0 400 200" class="distortion-diagram">
                            <!-- åŸå§‹ä½ç½® -->
                            <rect x="50" y="50" width="80" height="100" fill="#4a9eff" opacity="0.5" stroke="#4a9eff"/>
                            <text x="90" y="170" text-anchor="middle" fill="#4a9eff" font-size="11">åŸå§‹åƒç´ </text>
                            
                            <!-- ç®­å¤´ -->
                            <path d="M 150 100 Q 180 80 210 100" stroke="#ffff00" stroke-width="2" fill="none" marker-end="url(#distArrow)"/>
                            <text x="180" y="70" text-anchor="middle" fill="#ffff00" font-size="10">UV åç§»</text>
                            
                            <!-- æ‰­æ›²å -->
                            <rect x="220" y="40" width="80" height="100" fill="#ff8844" opacity="0.5" stroke="#ff8844" transform="skewX(-10)"/>
                            <text x="270" y="170" text-anchor="middle" fill="#ff8844" font-size="11">é‡‡æ ·ä½ç½®</text>
                            
                            <defs>
                                <marker id="distArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#ffff00"/>
                                </marker>
                            </defs>
                        </svg>
                    </div>
                </div>

                <div class="section">
                    <h2>ğŸ’» URP å®ç°</h2>
                    
                    <h3>åŸºç¡€æ‰­æ›² Shader</h3>
                    <pre class="shader-code">Shader "Custom/Distortion"
{
    Properties
    {
        _DistortionMap("Distortion Map", 2D) = "bump" {}
        _DistortionStrength("Strength", Range(0, 0.1)) = 0.02
    }
    
    SubShader
    {
        Tags { "RenderType"="Transparent" "Queue"="Transparent" "RenderPipeline"="UniversalPipeline" }
        
        Pass
        {
            HLSLPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/DeclareOpaqueTexture.hlsl"
            
            struct Attributes
            {
                float4 positionOS : POSITION;
                float2 uv : TEXCOORD0;
            };
            
            struct Varyings
            {
                float4 positionCS : SV_POSITION;
                float2 uv : TEXCOORD0;
                float4 screenPos : TEXCOORD1;
            };
            
            TEXTURE2D(_DistortionMap);
            SAMPLER(sampler_DistortionMap);
            
            CBUFFER_START(UnityPerMaterial)
                float4 _DistortionMap_ST;
                float _DistortionStrength;
            CBUFFER_END
            
            Varyings vert(Attributes input)
            {
                Varyings output;
                output.positionCS = TransformObjectToHClip(input.positionOS.xyz);
                output.uv = TRANSFORM_TEX(input.uv, _DistortionMap);
                output.screenPos = ComputeScreenPos(output.positionCS);
                return output;
            }
            
            half4 frag(Varyings input) : SV_Target
            {
                // é‡‡æ ·æ‰­æ›²è´´å›¾ï¼ˆæ³•çº¿è´´å›¾æ ¼å¼ï¼‰
                half4 distortTex = SAMPLE_TEXTURE2D(_DistortionMap, sampler_DistortionMap, input.uv);
                half2 distortion = (distortTex.xy * 2.0 - 1.0) * _DistortionStrength;
                
                // è®¡ç®—å±å¹• UV
                float2 screenUV = input.screenPos.xy / input.screenPos.w;
                
                // åº”ç”¨æ‰­æ›²
                screenUV += distortion;
                
                // é‡‡æ ·å±å¹•é¢œè‰²
                half4 sceneColor = SAMPLE_TEXTURE2D(_CameraOpaqueTexture, sampler_CameraOpaqueTexture, screenUV);
                
                return sceneColor;
            }
            ENDHLSL
        }
    }
}</pre>

                    <h3>åŠ¨æ€çƒ­æµªæ•ˆæœ</h3>
                    <pre class="shader-code">// ä½¿ç”¨å™ªå£°å’Œæ—¶é—´äº§ç”ŸåŠ¨æ€æ‰­æ›²
float2 AnimatedDistortion(float2 uv, float time)
{
    // å¤šå±‚å™ªå£°å åŠ 
    float2 offset1 = SAMPLE_TEXTURE2D(_NoiseMap, sampler_NoiseMap, uv + time * 0.1).xy;
    float2 offset2 = SAMPLE_TEXTURE2D(_NoiseMap, sampler_NoiseMap, uv * 2 - time * 0.15).xy;
    
    float2 distortion = (offset1 + offset2 - 1.0) * _Strength;
    return distortion;
}</pre>
                </div>

                <div class="section">
                    <h2">âš™ï¸ URP è®¾ç½®</h2>
                    
                    <div class="warning-box">
                        <h4>å¯ç”¨ Opaque Texture</h4>
                        <p>åœ¨ URP Asset ä¸­å¯ç”¨ "Opaque Texture" é€‰é¡¹ï¼Œå¦åˆ™ _CameraOpaqueTexture ä¸å¯ç”¨ã€‚</p>
                        <p><strong>è·¯å¾„ï¼š</strong>URP Asset > Quality > Opaque Texture = On</p>
                    </div>
                </div>

                <div class="section">
                    <h2>ğŸ® åº”ç”¨åœºæ™¯</h2>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h3>ğŸ”® ç»ç’ƒ/æ°´æ™¶</h3>
                            <p>é€æ˜ç‰©ä½“çš„æŠ˜å°„æ•ˆæœ</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>ğŸ”¥ çƒ­æµª</h3>
                            <p>ç«ç„°ã€æ²™æ¼ çš„ç©ºæ°”æ‰­æ›²</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>ğŸŒŠ æ°´ä¸‹</h3>
                            <p>æ°´é¢æŠ˜å°„ã€æ°´ä¸‹è§†è§’</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>ğŸ›¡ï¸ éšèº«æ•ˆæœ</h3>
                            <p>éšå½¢æ–—ç¯·çš„å…‰å­¦è¿·å½©</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>ğŸ’¡ æŠ€å·§</h2>
                    
                    <div class="tip-box">
                        <h4>è¾¹ç¼˜å¤„ç†</h4>
                        <p>æ‰­æ›²åçš„ UV å¯èƒ½è¶…å‡º [0,1] èŒƒå›´ï¼Œå»ºè®® clamp æˆ–ä½¿ç”¨è¾¹ç¼˜æ¸å˜ï¼š</p>
                        <pre class="shader-code">// è¾¹ç¼˜è¡°å‡
float edge = smoothstep(0, 0.1, screenUV.x) * smoothstep(1, 0.9, screenUV.x);
edge *= smoothstep(0, 0.1, screenUV.y) * smoothstep(1, 0.9, screenUV.y);
distortion *= edge;</pre>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/sidebar.js"></script>
    <script src="../js/shader-highlight.js"></script>
    <script src="../js/app.js"></script>
</body>
</html>
