<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Render Features - Unity URP 2022 LTS æ•™ç¨‹</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>URP æ•™ç¨‹</h1>
            </div>
            <nav class="nav-menu" id="navMenu">
                <div class="nav-section">
                    <h3">ğŸ”„ æ¸²æŸ“ç®¡çº¿</h3>
                    <ul>
                        <li><a href="urp-rendering-pipeline.html">URP æ¸²æŸ“æµç¨‹</a></li>
                        <li><a href="rendering-stages.html">æ¸²æŸ“é˜¶æ®µ</a></li>
                        <li><a href="pass-types.html">Pass ç±»å‹</a></li>
                        <li><a href="render-features.html" class="active">Render Features</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="function-page">
                <h1>Render Features</h1>
                <p class="subtitle">æ‰©å±• URP æ¸²æŸ“ç®¡çº¿</p>

                <div class="section">
                    <h2">ğŸ“š ä»€ä¹ˆæ˜¯ Render Feature</h2>
                    <p>Render Feature æ˜¯ URP æä¾›çš„æ‰©å±•æœºåˆ¶ï¼Œå…è®¸åœ¨æ¸²æŸ“ç®¡çº¿ä¸­æ’å…¥è‡ªå®šä¹‰æ¸²æŸ“é€»è¾‘ï¼Œå®ç°ç‰¹æ®Šæ•ˆæœã€‚</p>
                    
                    <div class="term-card">
                        <h3>ä½¿ç”¨æ–¹å¼</h3>
                        <div class="term-details">
                            <ol>
                                <li>åˆ›å»º ScriptableRendererFeature è„šæœ¬</li>
                                <li>åˆ›å»º ScriptableRenderPass è„šæœ¬</li>
                                <li>åœ¨ URP Asset çš„ Renderer ä¸­æ·»åŠ  Feature</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2">ğŸ’» åˆ›å»ºè‡ªå®šä¹‰ Render Feature</h2>
                    
                    <h3>1. ScriptableRendererFeature</h3>
                    <pre class="shader-code">using UnityEngine;
using UnityEngine.Rendering;
using UnityEngine.Rendering.Universal;

public class MyRenderFeature : ScriptableRendererFeature
{
    [System.Serializable]
    public class Settings
    {
        public RenderPassEvent renderPassEvent = RenderPassEvent.AfterRenderingOpaques;
        public Material material;
    }
    
    public Settings settings = new Settings();
    private MyRenderPass renderPass;
    
    public override void Create()
    {
        renderPass = new MyRenderPass(settings);
    }
    
    public override void AddRenderPasses(ScriptableRenderer renderer, ref RenderingData renderingData)
    {
        if (settings.material == null) return;
        renderer.EnqueuePass(renderPass);
    }
}</pre>

                    <h3>2. ScriptableRenderPass</h3>
                    <pre class="shader-code">public class MyRenderPass : ScriptableRenderPass
{
    private Material material;
    private RTHandle tempRT;
    
    public MyRenderPass(MyRenderFeature.Settings settings)
    {
        this.material = settings.material;
        this.renderPassEvent = settings.renderPassEvent;
    }
    
    public override void OnCameraSetup(CommandBuffer cmd, ref RenderingData renderingData)
    {
        var desc = renderingData.cameraData.cameraTargetDescriptor;
        RenderingUtils.ReAllocateIfNeeded(ref tempRT, desc, name: "_TempRT");
    }
    
    public override void Execute(ScriptableRenderContext context, ref RenderingData renderingData)
    {
        CommandBuffer cmd = CommandBufferPool.Get("MyRenderPass");
        
        var source = renderingData.cameraData.renderer.cameraColorTargetHandle;
        
        // Blit åˆ°ä¸´æ—¶ RT
        Blit(cmd, source, tempRT, material, 0);
        // Blit å›åŸå§‹ç›®æ ‡
        Blit(cmd, tempRT, source);
        
        context.ExecuteCommandBuffer(cmd);
        CommandBufferPool.Release(cmd);
    }
    
    public override void OnCameraCleanup(CommandBuffer cmd)
    {
        // æ¸…ç†
    }
}</pre>
                </div>

                <div class="section">
                    <h2">ğŸ¯ æ³¨å…¥æ—¶æœº (RenderPassEvent)</h2>
                    
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>äº‹ä»¶</th>
                                <th>è¯´æ˜</th>
                                <th>å¸¸è§ç”¨é€”</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>BeforeRendering</td>
                                <td>æ¸²æŸ“å¼€å§‹å‰</td>
                                <td>åˆå§‹åŒ–</td>
                            </tr>
                            <tr>
                                <td>BeforeRenderingShadows</td>
                                <td>é˜´å½±æ¸²æŸ“å‰</td>
                                <td>è‡ªå®šä¹‰é˜´å½±</td>
                            </tr>
                            <tr>
                                <td>AfterRenderingSkybox</td>
                                <td>å¤©ç©ºç›’å</td>
                                <td>å¤§æ°”æ•ˆæœ</td>
                            </tr>
                            <tr>
                                <td>AfterRenderingOpaques</td>
                                <td>ä¸é€æ˜ç‰©ä½“å</td>
                                <td>æè¾¹ã€é›¾æ•ˆ</td>
                            </tr>
                            <tr>
                                <td>AfterRenderingTransparents</td>
                                <td>é€æ˜ç‰©ä½“å</td>
                                <td>åå¤„ç†</td>
                            </tr>
                            <tr>
                                <td>AfterRendering</td>
                                <td>æ¸²æŸ“ç»“æŸå</td>
                                <td>æœ€ç»ˆå¤„ç†</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="section">
                    <h2">ğŸ® å¸¸è§åº”ç”¨</h2>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h3">ğŸ–¼ï¸ å…¨å±åå¤„ç†</h3>
                            <p>è‡ªå®šä¹‰åå¤„ç†æ•ˆæœ</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3">âœï¸ æè¾¹æ•ˆæœ</h3>
                            <p>åŸºäºæ·±åº¦/æ³•çº¿çš„æè¾¹</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3">ğŸŒŠ å¹³é¢åå°„</h3>
                            <p>æ°´é¢ã€é•œé¢åå°„</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3">ğŸ“º ç‰¹æ®Šæ¸²æŸ“</h3>
                            <p>æ¸²æŸ“ç‰¹å®šå±‚åˆ°RT</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2">âš ï¸ æ³¨æ„äº‹é¡¹</h2>
                    
                    <div class="warning-box">
                        <h4">Unity 2022 LTS å˜åŒ–</h4>
                        <p>Unity 2022 å¼€å§‹ä½¿ç”¨ <code>RTHandle</code> æ›¿ä»£ <code>RenderTargetIdentifier</code>ï¼Œç¡®ä¿ä½¿ç”¨æ–° APIã€‚</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/sidebar.js"></script>
    <script src="../js/shader-highlight.js"></script>
    <script src="../js/app.js"></script>
</body>
</html>
