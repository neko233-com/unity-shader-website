<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§èƒ½ä¼˜åŒ– - Unity URP 2022 LTS æ•™ç¨‹</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>URP æ•™ç¨‹</h1>
            </div>
            <nav class="nav-menu" id="navMenu">
                <div class="nav-section">
                    <h3>âš™ï¸ é«˜çº§ä¸»é¢˜</h3>
                    <ul>
                        <li><a href="shader-variants.html">Shader å˜ä½“</a></li>
                        <li><a href="compute-shader.html">Compute Shader</a></li>
                        <li><a href="custom-render-pass.html">è‡ªå®šä¹‰æ¸²æŸ“ Pass</a></li>
                        <li><a href="performance-optimization.html" class="active">æ€§èƒ½ä¼˜åŒ–</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="function-page">
                <h1>Shader æ€§èƒ½ä¼˜åŒ–</h1>
                <p class="subtitle">å†™å‡ºé«˜æ•ˆçš„ Shader ä»£ç </p>

                <div class="section">
                    <h2>ğŸ“Š æ€§èƒ½æŒ‡æ ‡</h2>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h3>ALU</h3>
                            <p>ç®—æœ¯é€»è¾‘è¿ç®—æ•°é‡</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>TEX</h3>
                            <p>çº¹ç†é‡‡æ ·æ¬¡æ•°</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>Overdraw</h3>
                            <p>åƒç´ é‡å¤ç»˜åˆ¶æ¬¡æ•°</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>å˜ä½“æ•°é‡</h3>
                            <p>Shader ç¼–è¯‘ç‰ˆæœ¬æ•°</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>ğŸš€ ä¼˜åŒ–æŠ€å·§</h2>
                    
                    <h3>1. ç²¾åº¦é€‰æ‹©</h3>
                    <pre class="shader-code">// âŒ ä¸å¿…è¦çš„é«˜ç²¾åº¦
float4 frag() : SV_Target
{
    float uv_x = input.uv.x;  // ç§»åŠ¨ç«¯ float å¼€é”€å¤§
    ...
}

// âœ… ä½¿ç”¨åˆé€‚çš„ç²¾åº¦
half4 frag() : SV_Target
{
    half2 uv = input.uv;      // UV ç”¨ half è¶³å¤Ÿ
    half3 color = ...;        // é¢œè‰²ç”¨ half
    float depth = ...;        // æ·±åº¦éœ€è¦ float
}</pre>

                    <div class="term-card">
                        <h4>ç²¾åº¦æŒ‡å—</h4>
                        <div class="term-details">
                            <ul>
                                <li><strong>halfï¼š</strong>é¢œè‰²ã€UVã€æ³•çº¿ã€å¤§éƒ¨åˆ†è®¡ç®—</li>
                                <li><strong>floatï¼š</strong>ä½ç½®ã€æ·±åº¦ã€å¤§æ•°å€¼è¿ç®—</li>
                                <li><strong>fixedï¼š</strong>å·²åºŸå¼ƒï¼Œæ”¹ç”¨ half</li>
                            </ul>
                        </div>
                    </div>

                    <h3>2. å‡å°‘çº¹ç†é‡‡æ ·</h3>
                    <pre class="shader-code">// âŒ å¤šæ¬¡é‡‡æ ·åŒä¸€çº¹ç†
half4 color1 = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, uv);
half4 color2 = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, uv + offset);
half4 color3 = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, uv - offset);

// âœ… çº¹ç†æ‰“åŒ… - å°†å¤šå¼ è´´å›¾åˆå¹¶
// R: Metallic, G: Occlusion, B: Detail, A: Smoothness
half4 masks = SAMPLE_TEXTURE2D(_MaskMap, sampler_MaskMap, uv);
half metallic = masks.r;
half occlusion = masks.g;
half smoothness = masks.a;</pre>

                    <h3>3. é¿å…åˆ†æ”¯</h3>
                    <pre class="shader-code">// âŒ åŠ¨æ€åˆ†æ”¯
if (useNormalMap)
{
    normal = UnpackNormal(tex);
}
else
{
    normal = half3(0, 0, 1);
}

// âœ… é™æ€åˆ†æ”¯ï¼ˆç¼–è¯‘æ—¶ç¡®å®šï¼‰
#if defined(_USE_NORMAL_MAP)
    normal = UnpackNormal(tex);
#else
    normal = half3(0, 0, 1);
#endif

// âœ… æˆ–ç”¨ lerp æ›¿ä»£
normal = lerp(half3(0, 0, 1), UnpackNormal(tex), _UseNormalMap);</pre>

                    <h3>4. è®¡ç®—ç§»åŠ¨åˆ°é¡¶ç‚¹ç€è‰²å™¨</h3>
                    <pre class="shader-code">// âŒ åœ¨ç‰‡æ®µç€è‰²å™¨è®¡ç®—
half4 frag(Varyings input) : SV_Target
{
    float3 viewDir = normalize(_WorldSpaceCameraPos - input.positionWS);
    float3 reflectDir = reflect(-viewDir, input.normalWS);
    ...
}

// âœ… ç§»åˆ°é¡¶ç‚¹ç€è‰²å™¨ï¼ˆå¦‚æœç²¾åº¦å…è®¸ï¼‰
Varyings vert(Attributes input)
{
    Varyings output;
    output.viewDirWS = normalize(_WorldSpaceCameraPos - positionWS);
    ...
}</pre>
                </div>

                <div class="section">
                    <h2>âš ï¸ å¸¸è§æ€§èƒ½é™·é˜±</h2>
                    
                    <div class="warning-box">
                        <h4>1. pow() å‡½æ•°</h4>
                        <p><code>pow(x, n)</code> åœ¨ x < 0 æ—¶å¯èƒ½äº§ç”Ÿ NaNã€‚ä½¿ç”¨å‰ç¡®ä¿ x >= 0ã€‚</p>
                        <pre class="shader-code">// å®‰å…¨çš„ pow
half safePow = pow(max(0, x), n);</pre>
                    </div>
                    
                    <div class="warning-box">
                        <h4>2. normalize() å¼€é”€</h4>
                        <p>æ¯æ¬¡ normalize éœ€è¦å¹³æ–¹æ ¹è¿ç®—ã€‚å¦‚æœå‘é‡å·²ç»æ˜¯å•ä½å‘é‡ï¼Œé¿å…é‡å¤å½’ä¸€åŒ–ã€‚</p>
                    </div>
                    
                    <div class="warning-box">
                        <h4>3. discard / clip</h4>
                        <p>Alpha Test ä¼šæ‰“æ–­ Early-Zï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å°½é‡å‡å°‘ä½¿ç”¨ã€‚</p>
                    </div>
                </div>

                <div class="section">
                    <h2>ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–</h2>
                    
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>ä¼˜åŒ–é¡¹</th>
                                <th>å»ºè®®</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>çº¹ç†é‡‡æ ·</td>
                                <td>æ¯ Pass â‰¤ 4 æ¬¡</td>
                            </tr>
                            <tr>
                                <td>ç²¾åº¦</td>
                                <td>ä¼˜å…ˆä½¿ç”¨ half</td>
                            </tr>
                            <tr>
                                <td>æ•°å­¦è¿ç®—</td>
                                <td>é¿å… sin/cos/powï¼Œç”¨æŸ¥æ‰¾è¡¨</td>
                            </tr>
                            <tr>
                                <td>å˜ä½“</td>
                                <td>æ§åˆ¶åœ¨ 100 ä¸ªä»¥å†…</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="section">
                    <h2>ğŸ”§ è°ƒè¯•å·¥å…·</h2>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h3>Frame Debugger</h3>
                            <p>Window > Analysis > Frame Debugger</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>RenderDoc</h3>
                            <p>è¯¦ç»† GPU åˆ†æ</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>Shader Compile</h3>
                            <p>æŸ¥çœ‹ç¼–è¯‘åçš„æŒ‡ä»¤</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/sidebar.js"></script>
    <script src="../js/shader-highlight.js"></script>
    <script src="../js/app.js"></script>
</body>
</html>
