<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>观察空间 - Unity URP 2022 LTS 教程</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>URP 教程</h1>
            </div>
            <nav class="nav-menu" id="navMenu">
                <div class="nav-section">
                    <h3>📐 坐标空间</h3>
                    <ul>
                        <li><a href="coordinate-spaces.html">坐标空间概述</a></li>
                        <li><a href="object-space.html">物体空间</a></li>
                        <li><a href="world-space.html">世界空间</a></li>
                        <li><a href="view-space.html" class="active">观察空间</a></li>
                        <li><a href="clip-space.html">裁剪空间</a></li>
                        <li><a href="screen-space.html">屏幕空间</a></li>
                        <li><a href="tangent-space.html">切线空间</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="function-page">
                <h1>观察空间 (View Space)</h1>
                <p class="subtitle">也称为相机空间、眼空间 (Camera Space / Eye Space)</p>

                <div class="section">
                    <h2>📚 定义</h2>
                    <p>观察空间是以相机为原点的坐标系统。相机位于原点，看向 -Z 方向（Unity 惯例），右边是 +X，上边是 +Y。</p>
                    
                    <div class="diagram-container">
                        <svg viewBox="0 0 350 250" class="space-diagram">
                            <!-- 相机图标 -->
                            <rect x="140" y="180" width="40" height="30" fill="#333" stroke="#4a9eff" stroke-width="2"/>
                            <polygon points="160,180 145,160 175,160" fill="#333" stroke="#4a9eff" stroke-width="2"/>
                            
                            <!-- 坐标轴 -->
                            <line x1="160" y1="195" x2="160" y2="100" stroke="#00ff88" stroke-width="2" marker-end="url(#arrowG2)"/>
                            <line x1="160" y1="195" x2="260" y2="195" stroke="#ff4444" stroke-width="2" marker-end="url(#arrowR2)"/>
                            <line x1="160" y1="195" x2="100" y2="240" stroke="#4a9eff" stroke-width="2" marker-end="url(#arrowB2)"/>
                            
                            <!-- 标签 -->
                            <text x="165" y="95" fill="#00ff88" font-size="12">+Y (上)</text>
                            <text x="265" y="200" fill="#ff4444" font-size="12">+X (右)</text>
                            <text x="60" y="250" fill="#4a9eff" font-size="12">-Z (前)</text>
                            
                            <!-- 视锥体 -->
                            <path d="M 160 195 L 80 80 L 240 80 Z" fill="none" stroke="#888" stroke-width="1" stroke-dasharray="5"/>
                            <text x="160" y="60" text-anchor="middle" fill="#888" font-size="11">视锥体</text>
                            
                            <defs>
                                <marker id="arrowG2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#00ff88"/>
                                </marker>
                                <marker id="arrowR2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#ff4444"/>
                                </marker>
                                <marker id="arrowB2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#4a9eff"/>
                                </marker>
                            </defs>
                        </svg>
                    </div>
                </div>

                <div class="section">
                    <h2>💻 在 Shader 中使用</h2>
                    
                    <pre class="shader-code">// 世界空间 → 观察空间
float3 positionVS = TransformWorldToView(positionWS);

// 或使用矩阵
float3 positionVS = mul(UNITY_MATRIX_V, float4(positionWS, 1.0)).xyz;

// 观察空间深度（常用于深度相关效果）
float viewDepth = -positionVS.z;  // 注意取负，因为相机看向 -Z</pre>
                </div>

                <div class="section">
                    <h2>🎮 应用场景</h2>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h3>🌫️ 线性雾</h3>
                            <p>基于观察空间深度的雾效</p>
                            <pre class="shader-code">float fogFactor = saturate((viewDepth - _FogStart) / (_FogEnd - _FogStart));</pre>
                        </div>
                        
                        <div class="feature-card">
                            <h3>📷 景深 (DOF)</h3>
                            <p>模糊强度基于焦距和深度</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3">🎯 Billboarding</h3>
                            <p>让物体始终面向相机</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>🔧 相关矩阵</h2>
                    
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>矩阵</th>
                                <th>说明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>UNITY_MATRIX_V</code></td>
                                <td>世界空间 → 观察空间</td>
                            </tr>
                            <tr>
                                <td><code>UNITY_MATRIX_I_V</code></td>
                                <td>观察空间 → 世界空间</td>
                            </tr>
                            <tr>
                                <td><code>UNITY_MATRIX_MV</code></td>
                                <td>物体空间 → 观察空间</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="nav-links">
                    <a href="world-space.html">← 世界空间</a>
                    <a href="clip-space.html">裁剪空间 →</a>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/sidebar.js"></script>
    <script src="../js/shader-highlight.js"></script>
    <script src="../js/app.js"></script>
</body>
</html>
