<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shader å˜ä½“ - Unity URP 2022 LTS æ•™ç¨‹</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>URP æ•™ç¨‹</h1>
            </div>
            <nav class="nav-menu" id="navMenu">
                <div class="nav-section">
                    <h3>âš™ï¸ é«˜çº§ä¸»é¢˜</h3>
                    <ul>
                        <li><a href="shader-variants.html" class="active">Shader å˜ä½“</a></li>
                        <li><a href="compute-shader.html">Compute Shader</a></li>
                        <li><a href="custom-render-pass.html">è‡ªå®šä¹‰æ¸²æŸ“ Pass</a></li>
                        <li><a href="performance-optimization.html">æ€§èƒ½ä¼˜åŒ–</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="function-page">
                <h1>Shader å˜ä½“ (Shader Variants)</h1>
                <p class="subtitle">ç†è§£å’Œç®¡ç† Shader å…³é”®å­—</p>

                <div class="section">
                    <h2>ğŸ“š ä»€ä¹ˆæ˜¯ Shader å˜ä½“</h2>
                    <p>Shader å˜ä½“æ˜¯åŒä¸€ä¸ª Shader çš„ä¸åŒç¼–è¯‘ç‰ˆæœ¬ï¼Œæ¯ä¸ªå˜ä½“å¯¹åº”ä¸åŒçš„åŠŸèƒ½ç»„åˆã€‚ä½¿ç”¨ <code>#pragma</code> æŒ‡ä»¤å®šä¹‰å…³é”®å­—æ¥ç”Ÿæˆå˜ä½“ã€‚</p>
                    
                    <div class="warning-box">
                        <h4>âš ï¸ å˜ä½“çˆ†ç‚¸</h4>
                        <p>å˜ä½“æ•°é‡ = 2^nï¼ˆn ä¸ºå…³é”®å­—æ•°é‡ï¼‰ã€‚10 ä¸ªå…³é”®å­—å°±ä¼šç”Ÿæˆ 1024 ä¸ªå˜ä½“ï¼</p>
                    </div>
                </div>

                <div class="section">
                    <h2>ğŸ’» å…³é”®å­—ç±»å‹</h2>
                    
                    <h3>multi_compile vs shader_feature</h3>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>æŒ‡ä»¤</th>
                                <th>ç¼–è¯‘è¡Œä¸º</th>
                                <th>é€‚ç”¨åœºæ™¯</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>multi_compile</code></td>
                                <td>ç¼–è¯‘æ‰€æœ‰å˜ä½“</td>
                                <td>å…¨å±€è®¾ç½®ï¼ˆé›¾æ•ˆã€ç¯å…‰ï¼‰</td>
                            </tr>
                            <tr>
                                <td><code>shader_feature</code></td>
                                <td>åªç¼–è¯‘ä½¿ç”¨çš„å˜ä½“</td>
                                <td>æè´¨ç‰¹å®šåŠŸèƒ½</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>ä»£ç ç¤ºä¾‹</h3>
                    <pre class="shader-code">// å¤šé€‰ä¸€çš„å…³é”®å­—ç»„
#pragma multi_compile _ _MAIN_LIGHT_SHADOWS
#pragma multi_compile _ _ADDITIONAL_LIGHTS

// æè´¨åŠŸèƒ½å¼€å…³
#pragma shader_feature _USE_NORMAL_MAP
#pragma shader_feature _USE_EMISSION

// æœ¬åœ°å…³é”®å­—ï¼ˆUnity 2019.3+ï¼‰
#pragma multi_compile_local _ _LOCAL_OPTION

// åœ¨ä»£ç ä¸­ä½¿ç”¨
#if defined(_USE_NORMAL_MAP)
    // æ³•çº¿è´´å›¾ç›¸å…³ä»£ç 
    half3 normalTS = UnpackNormal(SAMPLE_TEXTURE2D(_NormalMap, sampler_NormalMap, uv));
#else
    half3 normalTS = half3(0, 0, 1);
#endif</pre>
                </div>

                <div class="section">
                    <h2>ğŸ”§ URP å¸¸è§å…³é”®å­—</h2>
                    
                    <pre class="shader-code">// å…‰ç…§ç›¸å…³
#pragma multi_compile _ _MAIN_LIGHT_SHADOWS _MAIN_LIGHT_SHADOWS_CASCADE
#pragma multi_compile _ _ADDITIONAL_LIGHTS_VERTEX _ADDITIONAL_LIGHTS
#pragma multi_compile _ _ADDITIONAL_LIGHT_SHADOWS
#pragma multi_compile _ _SHADOWS_SOFT

// æ¸²æŸ“ç›¸å…³
#pragma multi_compile _ _MIXED_LIGHTING_SUBTRACTIVE
#pragma multi_compile _ LIGHTMAP_ON
#pragma multi_compile_fog

// GPU Instancing
#pragma multi_compile_instancing</pre>
                </div>

                <div class="section">
                    <h2>ğŸ“¦ å˜ä½“ç®¡ç†</h2>
                    
                    <h3>æŸ¥çœ‹å˜ä½“æ•°é‡</h3>
                    <div class="tip-box">
                        <p>åœ¨ Shader çš„ Inspector é¢æ¿ä¸­ç‚¹å‡» "Compile and show code" ä¸‹æ‹‰èœå•ï¼Œå¯ä»¥çœ‹åˆ°å˜ä½“æ•°é‡å’Œç¼–è¯‘æ—¶é—´ã€‚</p>
                    </div>
                    
                    <h3>å‰¥ç¦»ä¸éœ€è¦çš„å˜ä½“</h3>
                    <pre class="shader-code">// ä½¿ç”¨ IPreprocessShaders æ¥å£
using UnityEditor.Build;
using UnityEditor.Rendering;

class ShaderStripper : IPreprocessShaders
{
    public int callbackOrder => 0;
    
    public void OnProcessShader(Shader shader, ShaderSnippetData snippet, 
                                 IList<ShaderCompilerData> inputData)
    {
        for (int i = inputData.Count - 1; i >= 0; i--)
        {
            // ç§»é™¤ä¸éœ€è¦çš„å˜ä½“
            if (inputData[i].shaderKeywordSet.IsEnabled(
                new ShaderKeyword("_DEBUG_MODE")))
            {
                inputData.RemoveAt(i);
            }
        }
    }
}</pre>
                </div>

                <div class="section">
                    <h2>ğŸ’¡ æœ€ä½³å®è·µ</h2>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h3>1. ä½¿ç”¨ shader_feature</h3>
                            <p>æè´¨åŠŸèƒ½ä¼˜å…ˆä½¿ç”¨ shader_feature</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>2. æœ¬åœ°å…³é”®å­—</h3>
                            <p>ä½¿ç”¨ _local å‡å°‘å…¨å±€å…³é”®å­—å ç”¨</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>3. åˆå¹¶å…³é”®å­—</h3>
                            <p>ç›¸å…³åŠŸèƒ½ç”¨ä¸€ä¸ªå…³é”®å­—æ§åˆ¶å¤šä¸ªæ•ˆæœ</p>
                        </div>
                        
                        <div class="feature-card">
                            <h3>4. å®šæœŸæ£€æŸ¥</h3>
                            <p>ç›‘æ§å˜ä½“æ•°é‡ï¼Œé¿å…çˆ†ç‚¸å¼å¢é•¿</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/sidebar.js"></script>
    <script src="../js/shader-highlight.js"></script>
    <script src="../js/app.js"></script>
</body>
</html>
